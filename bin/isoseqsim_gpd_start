#!/usr/bin/env python
import argparse, sys, os, time
from subprocess import check_call

def main():
    args = do_inputs()
    sys.stdout.write("### Start analysis at " + time.strftime("%a,%d %b %Y %H:%M:%S") + "\n")
    sys.stdout.flush()
    
    gpd_file = args.gpd
    transcriptome_fa = args.transcriptome_fa

    sys.stdout.write("## Mode: normal\n")
    sys.stdout.write("# Step1: simulate Iso-Seq reads\n")
    sys.stdout.flush()
    cmd1 = os.path.dirname(os.path.realpath(__file__)) + "/../utilities/py_isoseqsim_simulate_reads_normal.py -g " + gpd_file + " -t " + transcriptome_fa + " -5 " + args.c5 + " -3 " + args.c3 + " -o " + args.output + " -s " + args.es + " -i " + args.ei + " -d " + args.ed + " -p " + args.cpu
    check_call(cmd1.split())

    sys.stdout.write("### Finish analysis at " + time.strftime("%a,%d %b %Y %H:%M:%S") + "\n")
    sys.stdout.flush()

def do_inputs():
    parser = argparse.ArgumentParser(description="IsoSeqSim: Iso-Seq reads simulator", formatter_class=argparse.ArgumentDefaultsHelpFormatter)
    parser.add_argument('-v', '--version', action='version', version='IsoSeqSim (version 0.1)')
    parser.add_argument('-p', '--gpd', type=str, required=True, help="Input: gene annotation file, GPD format")
    parser.add_argument('-t', '--transcriptome_fa', type=str, required=True, help="Input: transcriptome fasta file, generated from GPD file")
    parser.add_argument('-o', '--output', type=str, required=True, help="Output: simulated reads file, FASTA format. For more details, see README")
    parser.add_argument('--cpu', type=str, default='1', help="Number of thread")
    parser.add_argument('--c5', type=str, required=True, help="5'end completeness of transcripts. Tab-spit file: first column is the number of deleted nucleotides in comparison with reference gene annotation; second column is its frequency. Total frequency must be <= 1.0. Can choose from './utilities/5_end_completeness.*.tab' under the IsoSeqSim package")
    parser.add_argument('--c3', type=str, required=True, help="3'end completeness of transcripts. Tab-spit file: first column is the number of deleted nucleotides in comparison with reference gene annotation; second column is its frequency. Total frequency must be <= 1.0. Can choose from './utilities/3_end_completeness.*.tab' under the IsoSeqSim package")
    parser.add_argument('--es', type=str, default='0.017', help="Error rate: substitution. For more choices, see README")
    parser.add_argument('--ei', type=str, default='0.011', help="Error rate: insertion. For more choices, see README")
    parser.add_argument('--ed', type=str, default='0.022', help="Error rate: deletion. For more choices, see README")

    args = parser.parse_args()
    return args

if __name__ == "__main__":
    main()
